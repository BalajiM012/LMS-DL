<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>LMS Admin Dashboard - Enhanced</title>
    <link rel="stylesheet" href="styles.css" />
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        color: #333;
      }

      .header {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        padding: 15px 30px;
        box-shadow: 0 2px 20px rgba(0, 0, 0, 0.1);
        display: flex;
        justify-content: space-between;
        align-items: center;
        position: sticky;
        top: 0;
        z-index: 1000;
      }

      .welcome-section {
        text-align: center;
        flex: 1;
      }

      .welcome-title {
        font-size: 2.5rem;
        font-weight: bold;
        background: linear-gradient(135deg, #667eea, #764ba2);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        margin-bottom: 5px;
      }

      .user-name {
        font-size: 1.2rem;
        color: #666;
        font-weight: 500;
      }

      .nav-buttons {
        display: flex;
        gap: 15px;
        align-items: center;
      }

      .nav-btn {
        padding: 10px 20px;
        border: none;
        border-radius: 25px;
        cursor: pointer;
        font-weight: 600;
        transition: all 0.3s ease;
        text-decoration: none;
        display: inline-block;
      }

      .home-btn {
        background: linear-gradient(135deg, #667eea, #764ba2);
        color: white;
      }

      .logout-btn {
        background: #ff6b6b;
        color: white;
      }

      .nav-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
      }

      .container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 30px;
      }

      .search-section {
        background: white;
        padding: 30px;
        border-radius: 15px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        margin-bottom: 30px;
        text-align: center;
      }

      .search-container {
        display: flex;
        gap: 15px;
        justify-content: center;
        align-items: center;
        flex-wrap: wrap;
      }

      .search-input {
        padding: 12px 20px;
        border: 2px solid #e0e0e0;
        border-radius: 25px;
        font-size: 16px;
        width: 300px;
        transition: border-color 0.3s ease;
      }

      .search-input:focus {
        outline: none;
        border-color: #667eea;
      }

      .search-btn {
        padding: 12px 25px;
        background: linear-gradient(135deg, #667eea, #764ba2);
        color: white;
        border: none;
        border-radius: 25px;
        cursor: pointer;
        font-weight: 600;
        transition: all 0.3s ease;
      }

      .search-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
      }

      .features-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
        gap: 30px;
        margin-top: 30px;
      }

      .feature-card {
        background: white;
        padding: 30px;
        border-radius: 15px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        transition: transform 0.3s ease;
        text-align: center;
      }

      .feature-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 15px 40px rgba(0, 0, 0, 0.15);
      }

      .feature-icon {
        font-size: 3rem;
        margin-bottom: 15px;
        display: block;
      }

      .feature-title {
        font-size: 1.5rem;
        font-weight: bold;
        margin-bottom: 10px;
        color: #333;
      }

      .feature-description {
        color: #666;
        margin-bottom: 20px;
        line-height: 1.5;
      }

      .feature-btn {
        padding: 12px 30px;
        background: linear-gradient(135deg, #667eea, #764ba2);
        color: white;
        border: none;
        border-radius: 25px;
        cursor: pointer;
        font-weight: 600;
        transition: all 0.3s ease;
        text-decoration: none;
        display: inline-block;
      }

      .feature-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
      }

      .stats-section {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
      }

      .stat-card {
        background: white;
        padding: 25px;
        border-radius: 15px;
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
        text-align: center;
      }

      .stat-number {
        font-size: 2.5rem;
        font-weight: bold;
        color: #667eea;
        margin-bottom: 5px;
      }

      .stat-label {
        color: #666;
        font-size: 1.1rem;
      }

      .loading {
        text-align: center;
        padding: 50px;
        font-size: 1.2rem;
        color: #666;
      }

      .modal {
        display: none;
        position: fixed;
        z-index: 2000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
      }

      .modal-content {
        background-color: white;
        margin: 5% auto;
        padding: 30px;
        border-radius: 15px;
        width: 80%;
        max-width: 600px;
        max-height: 80vh;
        overflow-y: auto;
      }

      .close {
        color: #aaa;
        float: right;
        font-size: 28px;
        font-weight: bold;
        cursor: pointer;
      }

      .close:hover {
        color: #000;
      }

      .data-table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
      }

      .data-table th,
      .data-table td {
        padding: 12px;
        text-align: left;
        border-bottom: 1px solid #ddd;
      }

      .data-table th {
        background-color: #f8f9fa;
        font-weight: bold;
      }

      .action-btn {
        padding: 5px 10px;
        margin: 2px;
        border: none;
        border-radius: 3px;
        cursor: pointer;
        font-size: 12px;
      }

      .edit-btn {
        background-color: #ffc107;
        color: black;
      }

      .delete-btn {
        background-color: #dc3545;
        color: white;
      }

      .forecast-section {
        background: white;
        padding: 30px;
        border-radius: 15px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        margin-top: 30px;
      }

      .chart-container {
        height: 300px;
        margin: 20px 0;
      }
    </style>
  </head>
  <body>
    <header class="header">
      <div class="welcome-section">
        <h1 class="welcome-title">Welcome to LMS Website</h1>
        <p class="user-name" id="userName">Loading user...</p>
      </div>
      <div class="nav-buttons">
        <button class="nav-btn home-btn" onclick="goHome()">Home</button>
        <button class="nav-btn logout-btn" onclick="logout()">Logout</button>
      </div>
    </header>

    <div class="container">
      <!-- Search Section -->
      <div class="search-section">
        <h2>Search & Quick Actions</h2>
        <div class="search-container">
          <input
            type="text"
            id="searchInput"
            class="search-input"
            placeholder="Search books, users, or transactions..."
          />
          <button class="search-btn" onclick="performSearch()">Search</button>
          <button class="search-btn" onclick="clearSearch()">Clear</button>
        </div>
      </div>

      <!-- Statistics Section -->
      <div class="stats-section">
        <div class="stat-card">
          <div class="stat-number" id="totalBooks">0</div>
          <div class="stat-label">Total Books</div>
        </div>
        <div class="stat-card">
          <div class="stat-number" id="totalUsers">0</div>
          <div class="stat-label">Total Users</div>
        </div>
        <div class="stat-card">
          <div class="stat-number" id="borrowedBooks">0</div>
          <div class="stat-label">Borrowed Books</div>
        </div>
        <div class="stat-card">
          <div class="stat-number" id="totalFines">$0</div>
          <div class="stat-label">Total Fines</div>
        </div>
        <div class="stat-card">
          <div class="stat-number" id="overdueBooks">0</div>
          <div class="stat-label">Overdue Books</div>
        </div>
        <div class="stat-card">
          <div class="stat-number" id="datasetSize">0</div>
          <div class="stat-label">Dataset Size</div>
        </div>
      </div>

      <!-- Features Grid -->
      <div class="features-grid">
        <div class="feature-card">
          <span class="feature-icon">üìö</span>
          <h3 class="feature-title">Book Inventory</h3>
          <p class="feature-description">
            View and manage all books in the library system
          </p>
          <button class="feature-btn" onclick="openBookInventory()">
            View Inventory
          </button>
        </div>

        <div class="feature-card">
          <span class="feature-icon">‚öôÔ∏è</span>
          <h3 class="feature-title">Book Management</h3>
          <p class="feature-description">
            Add, edit, and remove books from the collection
          </p>
          <button class="feature-btn" onclick="openBookManagement()">
            Manage Books
          </button>
        </div>

        <div class="feature-card">
          <span class="feature-icon">üí∞</span>
          <h3 class="feature-title">Fine Calculation</h3>
          <p class="feature-description">
            Calculate and manage fines for overdue books
          </p>
          <button class="feature-btn" onclick="openFineCalculation()">
            Calculate Fines
          </button>
        </div>

        <div class="feature-card">
          <span class="feature-icon">üë•</span>
          <h3 class="feature-title">Manage Users</h3>
          <p class="feature-description">
            Administer user accounts and permissions
          </p>
          <button class="feature-btn" onclick="openUserManagement()">
            Manage Users
          </button>
        </div>

        <div class="feature-card">
          <span class="feature-icon">üìñ</span>
          <h3 class="feature-title">Borrowed Books History</h3>
          <p class="feature-description">
            Track all borrowed books and their history
          </p>
          <button
            class="feature-btn"
            onclick="window.location.href='admin-borrowed-history.html'"
          >
            View History
          </button>
        </div>

        <div class="feature-card">
          <span class="feature-icon">‚è∞</span>
          <h3 class="feature-title">Due Date Fine Tracking</h3>
          <p class="feature-description">
            Monitor overdue books and fine accumulation
          </p>
          <button class="feature-btn" onclick="openDueDateTracking()">
            Track Due Dates
          </button>
        </div>

        <div class="feature-card">
          <span class="feature-icon">üìä</span>
          <h3 class="feature-title">Dataset Management</h3>
          <p class="feature-description">Manage and update library datasets</p>
          <button class="feature-btn" onclick="openDatasetManagement()">
            Manage Dataset
          </button>
        </div>

        <div class="feature-card">
          <span class="feature-icon">üìà</span>
          <h3 class="feature-title">Data Forecast</h3>
          <p class="feature-description">
            Predict future trends and book demand
          </p>
          <button class="feature-btn" onclick="openDataForecast()">
            View Forecast
          </button>
        </div>
      </div>

      <!-- Forecast Section -->
      <div class="forecast-section">
        <h2>Library Analytics & Forecast</h2>
        <div class="chart-container" id="forecastChart">
          <canvas id="myChart" width="400" height="200"></canvas>
        </div>
      </div>
    </div>

    <!-- Modals -->
    <div id="modal" class="modal">
      <div class="modal-content">
        <span class="close" onclick="closeModal()">&times;</span>
        <div id="modalContent"></div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
      // Initialize dashboard
      document.addEventListener("DOMContentLoaded", function () {
        checkAuth();
        loadDashboardData();
        initializeChart();
      });

      // Authentication check
      function checkAuth() {
        const user = JSON.parse(sessionStorage.getItem("user"));
        if (!user || user.role !== "admin") {
          window.location.href = "login.html";
          return;
        }
        document.getElementById("userName").textContent = `Welcome, ${
          user.fullname || user.username || "Admin"
        }`;
      }

      // Load dashboard data
      async function loadDashboardData() {
        try {
          const response = await fetch("/api/dashboard/stats");
          if (response.ok) {
            const data = await response.json();
            updateStats(data);
          } else {
            // Use sample data if API not available
            updateStats({
              totalBooks: 1247,
              totalUsers: 892,
              borrowedBooks: 156,
              totalFines: 2340,
              overdueBooks: 23,
              datasetSize: 15420,
            });
          }
        } catch (error) {
          console.error("Error loading dashboard data:", error);
          // Use sample data
          updateStats({
            totalBooks: 1247,
            totalUsers: 892,
            borrowedBooks: 156,
            totalFines: 2340,
            overdueBooks: 23,
            datasetSize: 15420,
          });
        }
      }

      function updateStats(data) {
        document.getElementById("totalBooks").textContent = data.totalBooks;
        document.getElementById("totalUsers").textContent = data.totalUsers;
        document.getElementById("borrowedBooks").textContent =
          data.borrowedBooks;
        document.getElementById(
          "totalFines"
        ).textContent = `$${data.totalFines}`;
        document.getElementById("overdueBooks").textContent = data.overdueBooks;
        document.getElementById("datasetSize").textContent = data.datasetSize;
      }

      // Search functionality
      function performSearch() {
        const query = document.getElementById("searchInput").value;
        if (!query.trim()) {
          alert("Please enter a search term");
          return;
        }

        openModal(
          "Search Results",
          `
                <h3>Searching for: "${query}"</h3>
                <div class="loading">Searching...</div>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Type</th>
                            <th>Name</th>
                            <th>Details</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Book</td>
                            <td>Sample Book Title</td>
                            <td>Available</td>
                            <td>
                                <button class="action-btn edit-btn">Edit</button>
                                <button class="action-btn delete-btn">Delete</button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            `
        );
      }

      function clearSearch() {
        document.getElementById("searchInput").value = "";
      }

      // Feature functions
      function openBookInventory() {
        openModal(
          "Book Inventory",
          `
                <h3>Complete Book Inventory</h3>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Title</th>
                            <th>Author</th>
                            <th>ISBN</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="bookInventoryTable">
                        <tr>
                            <td>1</td>
                            <td>The Great Gatsby</td>
                            <td>F. Scott Fitzgerald</td>
                            <td>978-0-7432-7356-5</td>
                            <td>Available</td>
                            <td>
                                <button class="action-btn edit-btn">Edit</button>
                                <button class="action-btn delete-btn">Delete</button>
                            </td>
                        </tr>
                    </tbody>
                </table>
                <button class="feature-btn" onclick="loadBooks()">Refresh Data</button>
            `
        );
        loadBooks();
      }

      function openBookManagement() {
        openModal(
          "Book Management",
          `
                <h3>Add/Edit Book</h3>
                <form id="bookForm">
                    <input type="text" placeholder="Book Title" required style="width: 100%; padding: 10px; margin: 10px 0; border: 1px solid #ddd; border-radius: 5px;">
                    <input type="text" placeholder="Author" required style="width: 100%; padding: 10px; margin: 10px 0; border: 1px solid #ddd; border-radius: 5px;">
                    <input type="text" placeholder="ISBN" required style="width: 100%; padding: 10px; margin: 10px 0; border: 1px solid #ddd; border-radius: 5px;">
                    <button type="submit" class="feature-btn">Save Book</button>
                </form>
            `
        );
      }

      function openFineCalculation() {
        openModal(
          "Fine Calculation",
          `
                <h3>Calculate Fines</h3>
                <div>
                    <p>Overdue Books: <span id="overdueCount">23</span></p>
                    <p>Total Fine Amount: <span id="fineAmount">$340.50</span></p>
                    <button class="feature-btn" onclick="calculateFines()">Recalculate</button>
                </div>
            `
        );
      }

      function openUserManagement() {
        openModal(
          "User Management",
          `
                <h3>Manage Users</h3>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Name</th>
                            <th>Email</th>
                            <th>Role</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="userTable">
                        <tr>
                            <td>1</td>
                            <td>John Doe</td>
                            <td>john@example.com</td>
                            <td>Student</td>
                            <td>
                                <button class="action-btn edit-btn">Edit</button>
                                <button class="action-btn delete-btn">Delete</button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            `
        );
        loadUsers();
      }

      function openBorrowedHistory() {
        openModal(
          "Borrowed Books History",
          `
                <h3>All Borrowed Books</h3>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Book Title</th>
                            <th>User</th>
                            <th>Borrow Date</th>
                            <th>Due Date</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody id="borrowedTable">
                        <tr>
                            <td>The Great Gatsby</td>
                            <td>John Doe</td>
                            <td>2024-01-15</td>
                            <td>2024-01-29</td>
                            <td>Returned</td>
                        </tr>
                    </tbody>
                </table>
            `
        );
        loadBorrowedHistory();
      }

      function openDueDateTracking() {
        openModal(
          "Due Date Fine Tracking",
          `
                <h3>Overdue Books & Fines</h3>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Book</th>
                            <th>User</th>
                            <th>Due Date</th>
                            <th>Days Overdue</th>
                            <th>Fine</th>
                        </tr>
                    </thead>
                    <tbody id="dueDateTable">
                        <tr>
                            <td>1984</td>
                            <td>Jane Smith</td>
                            <td>2024-01-20</td>
                            <td>5</td>
                            <td>$2.50</td>
                        </tr>
                    </tbody>
                </table>
            `
        );
        loadDueDateTracking();
      }

      function openDatasetManagement() {
        openModal(
          "Dataset Management",
          `
                <h3>Library Dataset</h3>
                <div>
                    <p>Total Records: <span id="datasetCount">15,420</span></p>
                    <button class="feature-btn" onclick="exportDataset()">Export Data</button>
                    <button class="feature-btn" onclick="importDataset()">Import Data</button>
                    <input type="file" id="datasetFile" style="display: none;" accept=".csv,.json">
                </div>
            `
        );
      }

      function openDataForecast() {
        openModal(
          "Data Forecast",
          `
                <h3>Library Usage Forecast</h3>
                <canvas id="forecastModalChart" width="400" height="200"></canvas>
                <div style="margin-top: 20px;">
                    <p><strong>Next Month Predictions:</strong></p>
                    <p>Expected Book Borrowings: <span id="predictedBorrowings">187</span></p>
                    <p>Expected New Users: <span id="predictedUsers">23</span></p>
                </div>
            `
        );
        setTimeout(() => initializeForecastChart("forecastModalChart"), 100);
      }

      // Modal functions
      function openModal(title, content) {
        document.getElementById(
          "modalContent"
        ).innerHTML = `<h2>${title}</h2>${content}`;
        document.getElementById("modal").style.display = "block";
      }

      function closeModal() {
        document.getElementById("modal").style.display = "none";
      }

      // Navigation functions
      function goHome() {
        window.location.href = "index.html";
      }

      function logout() {
        sessionStorage.removeItem("user");
        window.location.href = "login.html";
      }

      // Chart initialization
      function initializeChart() {
        const ctx = document.getElementById("myChart");
        if (ctx) {
          new Chart(ctx, {
            type: "line",
            data: {
              labels: ["Jan", "Feb", "Mar", "Apr", "May", "Jun"],
              datasets: [
                {
                  label: "Book Borrowings",
                  data: [120, 190, 300, 500, 200, 300],
                  borderColor: "#667eea",
                  backgroundColor: "rgba(102, 126, 234, 0.1)",
                  tension: 0.4,
                },
                {
                  label: "New Users",
                  data: [50, 75, 100, 125, 80, 95],
                  borderColor: "#764ba2",
                  backgroundColor: "rgba(118, 75, 162, 0.1)",
                  tension: 0.4,
                },
              ],
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              plugins: {
                title: {
                  display: true,
                  text: "Library Usage Trends",
                },
              },
            },
          });
        }
      }

      function initializeForecastChart(canvasId) {
        const ctx = document.getElementById(canvasId);
        if (ctx) {
          new Chart(ctx, {
            type: "bar",
            data: {
              labels: [
                "Current",
                "Next Month",
                "Next 3 Months",
                "Next 6 Months",
              ],
              datasets: [
                {
                  label: "Predicted Book Borrowings",
                  data: [156, 187, 245, 320],
                  backgroundColor: "rgba(102, 126, 234, 0.8)",
                },
              ],
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
            },
          });
        }
      }

      // API functions
      async function loadBooks() {
        try {
          const response = await fetch("/api/books");
          const books = await response.json();
          // Update book table
        } catch (error) {
          console.error("Error loading books:", error);
        }
      }

      async function loadUsers() {
        try {
          const response = await fetch("/api/users");
          const users = await response.json();
          // Update user table
        } catch (error) {
          console.error("Error loading users:", error);
        }
      }

      async function loadBorrowedHistory() {
        try {
          const response = await fetch("/api/borrowed-history");
          const history = await response.json();
          // Update borrowed history table
        } catch (error) {
          console.error("Error loading borrowed history:", error);
        }
      }

      async function loadDueDateTracking() {
        try {
          const response = await fetch("/api/due-date-tracking");
          const tracking = await response.json();
          // Update due date tracking table
        } catch (error) {
          console.error("Error loading due date tracking:", error);
        }
      }

      function calculateFines() {
        // Calculate fines logic
        alert("Fines calculated successfully!");
      }

      function exportDataset() {
        // Export dataset logic
        alert("Dataset exported successfully!");
      }

      function importDataset() {
        document.getElementById("datasetFile").click();
      }

      // Close modal when clicking outside
      window.onclick = function (event) {
        const modal = document.getElementById("modal");
        if (event.target == modal) {
          modal.style.display = "none";
        }
      };
    </script>
  </body>
</html>
